<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>4EK Valentine Mailboxes</title>
  <style>
    :root{
      --bg:#0B0B0C;
      --panel:#111;
      --panel2:#121212;
      --header:#171717;
      --text:#EDE8D6;
      --muted:#B7B2A3;
      --gold:#C8A64B;
      --white:#ffffff;
      --danger:#ff6b6b;
      --ok:#7CFFB2;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family: Georgia, "Times New Roman", Times, serif;}
    a{color:var(--gold); text-decoration:underline; text-decoration-color:var(--gold)}
    .wrap{max-width:1100px;margin:0 auto;padding:24px 16px 48px}
    .topbar{border:2px solid var(--gold);background:var(--panel);border-radius:16px;overflow:hidden;}
    .topbar .ornate{padding:12px 16px;border-bottom:1px solid var(--gold);color:var(--gold);text-align:center;font-size:18px;}
    .topbar .head{padding:22px 18px 16px;text-align:center;}
    .title{margin:0;font-size:34px;letter-spacing:1px;line-height:1.15;}
    .subtitle{margin-top:10px;color:var(--muted);font-size:13px;}
    .ruleline{height:1px;background:var(--gold);margin:14px auto 8px;max-width:520px;}
    .flourish{color:var(--gold);font-size:16px;margin-bottom:4px;}
    .intro{margin:0 auto 18px;max-width:780px;color:var(--text);font-size:16px;line-height:1.65;}
    .rules{font-family:"Helvetica Neue", Helvetica, Arial, Verdana, sans-serif;font-size:13px;line-height:1.55;color:var(--muted);}
    .rules strong{color:var(--text)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(210px,1fr));gap:14px;margin-top:18px;}
    .card{
      border:1px solid var(--gold);
      background:var(--panel2);
      border-radius:16px;
      padding:14px;
      cursor:pointer;
      transition:transform .08s ease, box-shadow .08s ease;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
      min-height:132px;
    }
    .card:hover{transform:translateY(-1px)}
    .card:focus{outline:2px solid var(--gold);outline-offset:2px}
    .card .row{display:flex;gap:12px;align-items:center}
    .mailbox{
      width:54px;height:54px;
      border:1px solid var(--gold);
      border-radius:14px;
      display:flex;align-items:center;justify-content:center;
      background:#0f0f10;
      flex:0 0 auto;
      position:relative;
    }
    .mailbox:before{
      content:"";
      position:absolute;
      width:28px;height:16px;
      border:1px solid var(--gold);
      border-radius:6px;
      top:11px;
    }
    .mailbox:after{
      content:"";
      position:absolute;
      width:28px;height:20px;
      border:1px solid var(--gold);
      border-radius:6px;
      bottom:9px;
      background:linear-gradient(180deg, rgba(200,166,75,.08), rgba(200,166,75,.02));
    }
    .name{font-size:18px;margin:0;color:var(--white);line-height:1.2;}
    .meta{margin-top:6px;font-size:12px;color:var(--muted);line-height:1.4;}
    .layout{display:grid;grid-template-columns:1.2fr 0.8fr;gap:14px;margin-top:18px;align-items:start;}
    @media (max-width: 860px){.layout{grid-template-columns:1fr}}
    .panel{border:1px solid var(--gold);background:var(--panel2);border-radius:16px;overflow:hidden;}
    .panel .hd{
      padding:14px 16px;background:var(--header);border-bottom:1px solid var(--gold);
      display:flex;justify-content:space-between;gap:10px;align-items:center;flex-wrap:wrap;
    }
    .panel .hd h2{margin:0;font-size:18px;color:var(--gold);letter-spacing:.4px;}
    .panel .bd{padding:16px}
    .note{
      border:1px solid rgba(200,166,75,.65);
      border-radius:14px;
      padding:12px 12px;
      margin-bottom:10px;
      background:#0f0f10;
    }
    .note .msg{
      margin:0;font-size:15px;line-height:1.65;color:var(--white);
      white-space:pre-wrap;word-break:break-word;
    }
    .note .from{margin-top:10px;font-size:12px;color:var(--muted);}
    .empty{color:var(--muted);font-size:14px;line-height:1.6;padding:10px 0;}
    textarea, input, select{
      width:100%;
      border-radius:12px;
      border:1px solid rgba(200,166,75,.75);
      background:#0f0f10;
      color:var(--white);
      padding:10px 12px;
      font-family:"Helvetica Neue", Helvetica, Arial, Verdana, sans-serif;
      font-size:14px;
      outline:none;
    }
    textarea{min-height:150px;resize:vertical;line-height:1.55}
    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center;}
    .btn{
      display:inline-block;border-radius:10px;border:1px solid var(--gold);
      background:var(--gold);color:#111;font-weight:700;padding:10px 14px;font-size:13px;letter-spacing:.3px;
      text-decoration:none;cursor:pointer;font-family: Georgia, "Times New Roman", Times, serif;
    }
    .btn.secondary{background:transparent;color:var(--gold);}
    .status{font-size:12px;color:var(--muted);}
    .status.err{color:var(--danger)}
    .status.ok{color:var(--ok)}
    .small{font-size:12px;color:var(--muted);line-height:1.5;margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="ornate">. ›Å‚Çä ‚äπ . ›ÅÀñ . ›Å. ›Å‚Çä ‚äπ . ›ÅÀñ . ›Å. ›Å‚Çä ‚äπ . ›ÅÀñ . ›Å. ›Å‚Çä ‚äπ . ›ÅÀñ . ›Å</div>
      <div class="head">
        <h1 class="title">4EK <span style="color:var(--gold)">Valentine Mailboxes</span></h1>
        <div class="subtitle">2026 ‚Ä¢ University of Central Florida ‚Ä¢ 4EVER KNIGHTS</div>
        <div class="ruleline"></div>
        <div class="flourish">‚ù¶</div>
        <p class="intro">
          Click a mailbox to open it and read what‚Äôs inside. Leave a note at the bottom.
          <br><br>
          <span class="rules">
            <strong>Rules:</strong> kind messages only ‚Ä¢ no romantic pressure ‚Ä¢ no profanity
          </span>
        </p>
      </div>
    </div>

    <div id="mailboxGrid" class="grid" aria-label="Mailbox list"></div>

    <div class="layout">
      <div class="panel" aria-live="polite">
        <div class="hd">
          <h2 id="openTitle">Open a mailbox</h2>
          <div class="status" id="loadStatus"></div>
        </div>
        <div class="bd" id="notesArea">
          <div class="empty">Pick a mailbox above to see the notes inside.</div>
        </div>
      </div>

      <div class="panel">
        <div class="hd">
          <h2>Write a note</h2>
          <div class="status" id="composeStatus"></div>
        </div>
        <div class="bd">
          <label for="toSelect">To</label>
          <select id="toSelect"></select>

          <label for="message">Message</label>
          <textarea id="message" placeholder="Write your note‚Ä¶"></textarea>

          <label for="signature">Signature (optional)</label>
          <input id="signature" type="text" placeholder="Leave blank to be anonymous" />

          <input id="company" type="text" style="display:none" tabindex="-1" autocomplete="off" />

          <div class="actions">
            <button class="btn" id="sendBtn" type="button">Sign & Send</button>
            <button class="btn secondary" id="clearBtn" type="button">Clear</button>
          </div>

          <div class="small">Notes appear instantly after sending.</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /***********************
     * CONFIG (UPDATED ‚úÖ)
     ***********************/
    const API_URL = "https://script.google.com/macros/s/AKfycbx1cKc_5vESx9v3764CEJLu8A3Wn2Nwe8pWBGz0mrnT91kLJOmuW9SzZy3LY8PnI66UnA/exec";

    const AMBASSADORS = [
      { name:"Anna", slug:"anna" },
      { name:"Abigail", slug:"abigail" },
      { name:"Adrian", slug:"adrian" },
      { name:"Alayna", slug:"alayna" },
      { name:"Anjali", slug:"anjali" },
      { name:"Armaan", slug:"armaan" },
      { name:"Axani", slug:"axani" },
      { name:"Brooke", slug:"brooke" },
      { name:"Chloe", slug:"chloe" },
      { name:"Colin", slug:"colin" },
      { name:"Ella", slug:"ella" },
      { name:"Gabe", slug:"gabe" },
      { name:"Hannah", slug:"hannah" },
      { name:"Jaya", slug:"jaya" },
      { name:"Julia", slug:"julia" },
      { name:"Makenzie", slug:"makenzie" },
      { name:"Mitchell", slug:"mitchell" },
      { name:"Neha", slug:"neha" },
      { name:"Olivia", slug:"olivia" },
      { name:"Sam", slug:"sam" },
      { name:"Sarah", slug:"sarah" },
      { name:"Sruthi", slug:"sruthi" },
      { name:"Stella", slug:"stella" },
      { name:"Subrina", slug:"subrina" },
      { name:"Tylia", slug:"tylia" }
    ];

    const PROFANITY = ["fuck","shit","bitch","asshole","dick","pussy","cunt","slut","whore","nigger","faggot"];

    function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); }
    function containsProfanity(text){
      const t = (text || "").toLowerCase();
      return PROFANITY.some(w => new RegExp(`\\b${escapeRegExp(w)}\\b`, "i").test(t));
    }

    const elGrid   = document.getElementById("mailboxGrid");
    const elTo     = document.getElementById("toSelect");
    const elMsg    = document.getElementById("message");
    const elSig    = document.getElementById("signature");
    const elBot    = document.getElementById("company");
    const elSend   = document.getElementById("sendBtn");
    const elClear  = document.getElementById("clearBtn");

    const elTitle  = document.getElementById("openTitle");
    const elNotes  = document.getElementById("notesArea");
    const elLoadSt = document.getElementById("loadStatus");
    const elCompSt = document.getElementById("composeStatus");

    let currentMailbox = null;

    function init(){
      elTo.innerHTML = AMBASSADORS.map(a => `<option value="${a.slug}">${a.name}</option>`).join("");

      elGrid.innerHTML = AMBASSADORS.map(a => `
        <div class="card" role="button" tabindex="0" data-mailbox="${a.slug}" aria-label="Open mailbox for ${a.name}">
          <div class="row">
            <div class="mailbox" aria-hidden="true"></div>
            <div>
              <p class="name">${escapeHTML(a.name)}</p>
              <div class="meta">Click to open</div>
            </div>
          </div>
        </div>
      `).join("");

      elGrid.querySelectorAll("[data-mailbox]").forEach(btn => {
        btn.addEventListener("click", () => openMailbox(btn.getAttribute("data-mailbox")));
        btn.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            openMailbox(btn.getAttribute("data-mailbox"));
          }
        });
      });

      elSend.addEventListener("click", onSend);
      elClear.addEventListener("click", () => {
        elMsg.value = "";
        elSig.value = "";
        setComposeStatus("", "");
      });
    }

    async function openMailbox(slug){
      const amb = AMBASSADORS.find(a => a.slug === slug);
      if(!amb) return;

      currentMailbox = slug;
      elTitle.textContent = `Mailbox: ${amb.name}`;
      elNotes.innerHTML = `<div class="empty">Loading notes‚Ä¶</div>`;
      setLoadStatus("Loading‚Ä¶", "");

      try{
        const url = `${API_URL}?action=list&to=${encodeURIComponent(slug)}&t=${Date.now()}`;
        const res = await fetch(url);
        if(!res.ok) throw new Error(`API error: ${res.status}`);
        const data = await res.json();

        const notes = Array.isArray(data.notes) ? data.notes : [];
        renderNotes(notes, amb.name);
        setLoadStatus(`${notes.length} note(s)`, "ok");
      }catch(err){
        console.error(err);
        elNotes.innerHTML = `<div class="empty">Couldn‚Äôt load notes right now. Try again in a minute.</div>`;
        setLoadStatus("Load failed", "err");
      }
    }

    function renderNotes(notes, mailboxName){
      if(!notes.length){
        elNotes.innerHTML = `<div class="empty">No notes yet for <strong>${escapeHTML(mailboxName)}</strong>. Be the first üíå</div>`;
        return;
      }
      notes.sort((a,b) => (b.ts||0) - (a.ts||0));
      elNotes.innerHTML = notes.map(n => {
        const from = (n.from && n.from.trim()) ? n.from.trim() : "Anonymous";
        return `
          <div class="note">
            <p class="msg">${escapeHTML(n.message || "")}</p>
            <div class="from">‚Äî ${escapeHTML(from)}</div>
          </div>
        `;
      }).join("");
    }

    async function onSend(){
      const to = elTo.value;
      const amb = AMBASSADORS.find(a => a.slug === to);

      const message = (elMsg.value || "").trim();
      const signature = (elSig.value || "").trim();

      if(!amb){
        setComposeStatus("Choose a recipient.", "err");
        return;
      }
      if(elBot.value){
        setComposeStatus("Couldn‚Äôt send. Try again.", "err");
        return;
      }
      if(message.length < 2){
        setComposeStatus("Write a message before sending.", "err");
        return;
      }
      if(message.length > 1200){
        setComposeStatus("Keep it under 1200 characters.", "err");
        return;
      }
      if(containsProfanity(message) || containsProfanity(signature)){
        setComposeStatus("Please remove profanity and try again.", "err");
        return;
      }

      setComposeStatus("Sending‚Ä¶", "");

      try{
        const payload = { to, message, from: signature };
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type":"text/plain;charset=utf-8" },
          body: JSON.stringify(payload)
        });

        const data = await res.json().catch(()=>({}));
        if(!res.ok || data.ok !== true){
          throw new Error(data.error || `Send failed (${res.status})`);
        }

        setComposeStatus("Sent üíõ", "ok");
        elMsg.value = "";
        elSig.value = "";

        openMailbox(to);
      }catch(err){
        console.error(err);
        setComposeStatus("Couldn‚Äôt send. Try again.", "err");
      }
    }

    function setLoadStatus(text, kind){
      elLoadSt.textContent = text || "";
      elLoadSt.className = "status" + (kind ? " " + kind : "");
    }
    function setComposeStatus(text, kind){
      elCompSt.textContent = text || "";
      elCompSt.className = "status" + (kind ? " " + kind : "");
    }

    function escapeHTML(s){
      return String(s ?? "")
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#39;");
    }

    init();
  </script>
</body>
</html>
